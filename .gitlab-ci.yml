image: node:20

stages:
  - build-test

variables:
  PNPM_HOME: ".pnpm-store"

cache:
  key:
    files:
      - pnpm-lock.yaml
  paths:
    - .pnpm-store
    - node_modules

before_script:
  - corepack enable
  - corepack prepare pnpm@10.0.0 --activate
  - pnpm config set store-dir .pnpm-store
  - pnpm install --frozen-lockfile

build-test:
  stage: build-test
  script:
    - pnpm build
    - pnpm lint || echo "Lint failed but continuing"
    - pnpm test || echo "Tests failed but continuing"
  artifacts:
    when: always
    paths:
      - coverage/
    expire_in: 1 week
